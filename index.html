<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Roguelite Yahtzee</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Press+Start+2P&display=swap');
        :root{
            --accent-1: #ff4d4d;
            --accent-2: #ffec70;
            --accent-3: #ffb347;
            --bg-grad: linear-gradient(135deg, var(--accent-2) 0%, var(--accent-1) 100%);
        }
        html, body {
            height: 100%;
            margin: 0;
            background: var(--bg-grad);
            font-family: 'Press Start 2P', cursive;
            overflow: hidden;
            color: #fff;
        }

        /* App layout */
        #app {
            height: 100%;
            display: flex;
            flex-direction: column;
            gap: 12px;
            align-items: center;
            justify-content: center;
            padding: 18px;
            box-sizing: border-box;
        }

        header#header {
            width: 100%;
            max-width: 1100px;
            display: flex;
            align-items: center;
            justify-content: space-between;
            gap: 12px;
            pointer-events: auto;
        }

        .stats {
            display: flex;
            gap: 12px;
            align-items: center;
            color: #fff;
            text-shadow: 2px 2px 0 var(--accent-1), 0 0 8px var(--accent-2);
            font-size: 14px;
            flex-wrap: wrap;
        }

        .stat-pill {
            background: rgba(0,0,0,0.28);
            border: 2px solid rgba(255,255,255,0.08);
            padding: 8px 12px;
            border-radius: 8px;
            display: inline-flex;
            align-items: center;
            gap: 8px;
        }

        .controls {
            display: flex;
            gap: 12px;
            align-items: center;
        }

        .btn {
            pointer-events: auto;
            font-family: 'Press Start 2P', cursive;
            font-size: 14px;
            padding: 8px 14px;
            border-radius: 8px;
            border: 2px solid var(--accent-1);
            cursor: pointer;
            background: var(--accent-2);
            color: var(--accent-1);
            transition: transform .08s ease, filter .12s ease;
        }
        .btn.secondary { background: var(--accent-1); color: #fff; border-color: var(--accent-2); }
        .btn:active { transform: translateY(1px) scale(0.995); }

        /* Canvas area */
        main.main {
            width: 100%;
            flex: 1 1 auto;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        .canvas-wrap {
            width: min(92vw, 960px);
            height: auto;
            background: rgba(0,0,0,0.08);
            padding: 18px;
            border-radius: 12px;
            box-shadow: 0 8px 32px rgba(0,0,0,0.25);
            display: flex;
            align-items: center;
            justify-content: center;
        }
        #gameCanvas {
            background: #222;
            border: 10px solid var(--accent-1);
            image-rendering: pixelated;
            box-shadow: 0 0 36px var(--accent-2), 0 0 12px var(--accent-1);
            max-width: 100%;
            height: auto;
            display: block;
        }

        /* Shop as right-side slide panel */
        #shop {
            position: fixed;
            top: 12px;
            right: 12px;
            width: min(360px, 90vw);
            height: calc(100% - 24px);
            background: #fff8e1;
            border: 4px solid var(--accent-1);
            border-radius: 12px;
            padding: 16px;
            display: none; /* controlled by JS */
            z-index: 1200;
            font-family: 'Press Start 2P', cursive;
            color: var(--accent-1);
            box-shadow: 0 8px 40px rgba(0,0,0,0.35);
            overflow: auto;
            transform: translateX(18px);
            transition: transform 280ms ease, opacity 200ms ease;
        }
        #shop.open { transform: translateX(0); }

        .shop-title { font-size: 16px; margin-bottom: 8px; color: var(--accent-1); }
        .shop-list { display: flex; flex-direction: column; gap: 10px; }
        .shop-item {
            margin: 0;
            cursor: pointer;
            background: linear-gradient(180deg,var(--accent-2),#ffe066);
            border: 2px solid var(--accent-1);
            border-radius: 8px;
            padding: 10px;
            transition: transform .12s ease, box-shadow .12s ease;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        .shop-item:hover { transform: translateY(-3px); box-shadow: 0 8px 18px rgba(0,0,0,0.12); }
        .shop-icon { width: 26px; height: 26px; }
        #closeShop { margin-top: 12px; }

        @media (max-width: 640px) {
            .stats { font-size: 12px; }
            .btn { font-size: 12px; padding: 6px 10px; }
            header#header { padding: 6px; }
            #shop { width: 92vw; left: 50%; right: auto; transform: translateX(50%); top: auto; bottom: 12px; height: auto; }
        }
    </style>
</head>
<body>
    <div id="app">
        <header id="header">
            <div class="stats">
                <div class="stat-pill"><span id="score">Score: 0</span></div>
                <div class="stat-pill"><span id="gold">Gold: 0</span></div>
                <div class="stat-pill"><span id="rerolls">Rerolls: 3</span></div>
                <div class="stat-pill"><span id="deck"></span></div>
            </div>
            <div class="controls">
                <button id="rollBtn" class="btn">Roll Dice</button>
                <button id="shopBtn" class="btn secondary">Shop</button>
            </div>
        </header>

        <main class="main">
            <div class="canvas-wrap">
                <canvas id="gameCanvas" width="640" height="480"></canvas>
            </div>
        </main>

        <aside id="shop" aria-hidden="true">
            <div class="shop-title">Shop</div>
            <div id="shopItems" class="shop-list"></div>
            <button id="closeShop" class="btn">Close</button>
        </aside>
    </div>
    <script>
        // --- Pixel Art Dice Sprites ---
        const diceSprites = {
            normal: [
                // 6x6 pixel art for each face (1-6)
                [
                    [0,0,0,0,0,0],
                    [0,0,0,0,0,0],
                    [0,0,2,0,0,0],
                    [0,0,0,0,0,0],
                    [0,0,0,0,0,0],
                    [0,0,0,0,0,0],
                ],
                [
                    [0,0,0,0,0,0],
                    [0,2,0,0,0,0],
                    [0,0,0,0,0,0],
                    [0,0,0,0,2,0],
                    [0,0,0,0,0,0],
                    [0,0,0,0,0,0],
                ],
                [
                    [0,0,0,0,0,0],
                    [0,2,0,0,0,0],
                    [0,0,2,0,0,0],
                    [0,0,0,0,2,0],
                    [0,0,0,0,0,0],
                    [0,0,0,0,0,0],
                ],
                [
                    [0,2,0,0,2,0],
                    [0,0,0,0,0,0],
                    [0,0,0,0,0,0],
                    [0,0,0,0,0,0],
                    [0,2,0,0,2,0],
                    [0,0,0,0,0,0],
                ],
                [
                    [0,2,0,0,2,0],
                    [0,0,0,0,0,0],
                    [0,0,2,0,0,0],
                    [0,0,0,0,0,0],
                    [0,2,0,0,2,0],
                    [0,0,0,0,0,0],
                ],
                [
                    [0,2,0,0,2,0],
                    [0,0,0,0,0,0],
                    [0,2,0,0,2,0],
                    [0,0,0,0,0,0],
                    [0,2,0,0,2,0],
                    [0,0,0,0,0,0],
                ]
            ],
            // Fire Die: Red border, burns for extra points
            fire: [
                // Same faces, but color code 3 for border
            ],
            // Lucky Die: Yellow border, reroll 1s
            lucky: [
                // Same faces, but color code 4 for border
            ],
            // Shield Die: Orange border, blocks negative effects
            shield: [
                // Same faces, but color code 5 for border
            ]
        };
        // Fill in fire/lucky/shield dice with colored borders
        function makeColoredDice(base, borderColor) {
            return base.map(face => face.map((row, y) =>
                row.map((cell, x) => {
                    if (x === 0 || x === 5 || y === 0 || y === 5) return borderColor;
                    return cell;
                })
            ));
        }
        diceSprites.fire = makeColoredDice(diceSprites.normal, 3);
        diceSprites.lucky = makeColoredDice(diceSprites.normal, 4);
        diceSprites.shield = makeColoredDice(diceSprites.normal, 5);

        // --- Dice Definitions ---
        const diceTypes = [
            {
                name: "Normal Die",
                key: "normal",
                desc: "Standard die. No special effect.",
                color: "#fff",
                unlock: 0,
                ability: (rolls, idx, state) => rolls[idx], // No effect
            },
            {
                name: "Fire Die",
                key: "fire",
                desc: "Burn: +2 points if you roll a 6.",
                color: "#ff4d4d",
                unlock: 10,
                ability: (rolls, idx, state) => {
                    if (rolls[idx] === 6) state.bonus += 2;
                    return rolls[idx];
                }
            },
            {
                name: "Lucky Die",
                key: "lucky",
                desc: "Reroll: 1s are rerolled once.",
                color: "#ffec70",
                unlock: 20,
                ability: (rolls, idx, state) => {
                    if (rolls[idx] === 1) {
                        let reroll = Math.floor(Math.random() * 6) + 1;
                        return reroll;
                    }
                    return rolls[idx];
                }
            },
            {
                name: "Shield Die",
                key: "shield",
                desc: "Block: Prevents negative shop events.",
                color: "#ffb347",
                unlock: 30,
                ability: (rolls, idx, state) => rolls[idx]
            }
        ];

        // --- Game State ---
        let state = {
            score: 0,
            gold: 0,
            rerolls: 3,
            deck: [{type: "normal"}, {type: "normal"}, {type: "normal"}, {type: "normal"}, {type: "normal"}],
            unlocked: ["normal"],
            shopOpen: false,
            bonus: 0,
            anim: null,
            diceResults: [],
            round: 1,
            upgrades: [],
        };

        // --- Canvas Setup ---
        const canvas = document.getElementById('gameCanvas');
        const ctx = canvas.getContext('2d');
        const W = canvas.width, H = canvas.height;

        // --- Utility Functions ---
        function drawPixelDie(x, y, size, face, type) {
            // face: 1-6, type: dice key
            const sprite = diceSprites[type][face-1];
            for (let py=0; py<6; ++py) {
                for (let px=0; px<6; ++px) {
                    let c = sprite[py][px];
                    if (c === 0) continue;
                    ctx.fillStyle = (
                        c === 2 ? "#222" : // pip
                        c === 3 ? "#ff4d4d" : // fire border
                        c === 4 ? "#ffec70" : // lucky border
                        c === 5 ? "#ffb347" : // shield border
                        "#fff"
                    );
                    ctx.fillRect(x+px*size/6, y+py*size/6, size/6, size/6);
                }
            }
            // Outline
            ctx.strokeStyle = "#000";
            ctx.lineWidth = 2;
            ctx.strokeRect(x, y, size, size);
        }

        function drawDiceRow(results, deck, animY=0) {
            let n = deck.length;
            let size = 64;
            let gap = 24;
            let startX = (W - (n*size + (n-1)*gap)) / 2;
            for (let i=0; i<n; ++i) {
                let dieType = deck[i].type;
                let face = results[i] || 1;
                drawPixelDie(startX + i*(size+gap), H/2 - size/2 + animY, size, face, dieType);
            }
        }

        function updateUI() {
            document.getElementById('score').textContent = `Score: ${state.score}`;
            document.getElementById('gold').textContent = `Gold: ${state.gold}`;
            document.getElementById('rerolls').textContent = `Rerolls: ${state.rerolls}`;
            document.getElementById('deck').textContent = `Deck: ${state.deck.map(d => diceTypes.find(dt=>dt.key===d.type).name).join(", ")}`;
        }

        // --- Animation ---
        function animateRoll(results, deck, callback) {
            let frames = 24;
            let animFrame = 0;
            function frame() {
                ctx.clearRect(0,0,W,H);
                // Animate dice "jumping"
                let animY = Math.sin(animFrame/frames * Math.PI) * 40;
                drawDiceRow(results.map(()=>Math.floor(Math.random()*6)+1), deck, animY);
                animFrame++;
                if (animFrame < frames) {
                    requestAnimationFrame(frame);
                } else {
                    ctx.clearRect(0,0,W,H);
                    drawDiceRow(results, deck, 0);
                    callback();
                }
            }
            frame();
        }

        function animateCelebration(results, deck, callback) {
            let frames = 32;
            let animFrame = 0;
            function frame() {
                ctx.clearRect(0,0,W,H);
                drawDiceRow(results, deck, 0);
                // Fireworks
                for (let i=0; i<10; ++i) {
                    let angle = Math.random()*2*Math.PI;
                    let r = Math.random()*80 + 40;
                    let x = W/2 + Math.cos(angle)*r;
                    let y = H/2 + Math.sin(angle)*r;
                    ctx.fillStyle = Math.random() > 0.5 ? "#ffec70" : "#ff4d4d";
                    ctx.globalAlpha = 1 - animFrame/frames;
                    ctx.beginPath();
                    ctx.arc(x, y, 8, 0, 2*Math.PI);
                    ctx.fill();
                }
                ctx.globalAlpha = 1;
                animFrame++;
                if (animFrame < frames) {
                    requestAnimationFrame(frame);
                } else {
                    ctx.clearRect(0,0,W,H);
                    drawDiceRow(results, deck, 0);
                    callback();
                }
            }
            frame();
        }

        // --- Game Logic ---
        function rollDice() {
            state.bonus = 0;
            let results = [];
            for (let i=0; i<state.deck.length; ++i) {
                let roll = Math.floor(Math.random()*6)+1;
                results.push(roll);
            }
            // Apply dice abilities
            for (let i=0; i<state.deck.length; ++i) {
                let dieType = state.deck[i].type;
                let dieDef = diceTypes.find(dt=>dt.key===dieType);
                results[i] = dieDef.ability(results, i, state);
            }
            state.diceResults = results;
            animateRoll(results, state.deck, () => {
                ctx.clearRect(0,0,W,H);
                drawDiceRow(results, state.deck, 0);
                let score = scoreYahtzee(results) + state.bonus;
                state.score += score;
                state.gold += Math.floor(score/2);
                updateUI();
                if (score >= 25) {
                    animateCelebration(results, state.deck, () => {});
                }
            });
        }

        function scoreYahtzee(results) {
            // Simple scoring: Yahtzee (all same): 50, Four of a kind: 30, Full house: 25, Large straight: 40, Small straight: 30, Three of a kind: 20, else sum
            let counts = {};
            for (let v of results) counts[v] = (counts[v]||0)+1;
            let vals = Object.values(counts);
            let unique = Object.keys(counts).map(Number);
            unique.sort((a,b)=>a-b);
            if (vals.includes(5)) return 50; // Yahtzee
            if (vals.includes(4)) return 30;
            if (vals.includes(3) && vals.includes(2)) return 25; // Full house
            if (unique.join() === "1,2,3,4,5" || unique.join() === "2,3,4,5,6") return 40; // Large straight
            if (unique.length >= 4 && (
                unique.slice(0,4).join() === "1,2,3,4" ||
                unique.slice(1,5).join() === "2,3,4,5" ||
                unique.slice(2,6).join() === "3,4,5,6"
            )) return 30; // Small straight
            if (vals.includes(3)) return 20;
            return results.reduce((a,b)=>a+b,0);
        }

        // --- Shop ---
        const shopItems = [
            {
                name: "Upgrade: +1 Reroll",
                desc: "Gain an extra reroll per round.",
                cost: 10,
                icon: "🔄",
                effect: () => { state.rerolls += 1; }
            },
            {
                name: "Unlock: Fire Die",
                desc: "Unlocks Fire Die for your deck.",
                cost: 15,
                icon: "🔥",
                effect: () => { if (!state.unlocked.includes("fire")) state.unlocked.push("fire"); }
            },
            {
                name: "Unlock: Lucky Die",
                desc: "Unlocks Lucky Die for your deck.",
                cost: 20,
                icon: "🍀",
                effect: () => { if (!state.unlocked.includes("lucky")) state.unlocked.push("lucky"); }
            },
            {
                name: "Unlock: Shield Die",
                desc: "Unlocks Shield Die for your deck.",
                cost: 25,
                icon: "🛡️",
                effect: () => { if (!state.unlocked.includes("shield")) state.unlocked.push("shield"); }
            },
            {
                name: "Add Die to Deck",
                desc: "Add a random unlocked die to your deck.",
                cost: 12,
                icon: "🎲",
                effect: () => {
                    let unlocked = state.unlocked;
                    let type = unlocked[Math.floor(Math.random()*unlocked.length)];
                    state.deck.push({type});
                }
            },
            {
                name: "Upgrade: +1 Gold per Roll",
                desc: "Earn more gold per roll.",
                cost: 18,
                icon: "💰",
                effect: () => { state.upgrades.push("gold"); }
            }
        ];

        function openShop() {
            state.shopOpen = true;
            const shopEl = document.getElementById('shop');
            shopEl.style.display = 'block';
            // allow CSS transition to show slide-in
            requestAnimationFrame(() => shopEl.classList.add('open'));
            shopEl.setAttribute('aria-hidden','false');
            let shopDiv = document.getElementById('shopItems');
            shopDiv.innerHTML = '';
            shopItems.forEach((item, idx) => {
                let div = document.createElement('div');
                div.className = 'shop-item';
                div.innerHTML = `<span class="shop-icon">${item.icon}</span> <div style="flex:1;"><div style=\"font-weight:bold;color:var(--accent-1);\">${item.name}</div><div style=\"font-size:11px;color:#333;\">${item.desc}</div></div><div style=\"margin-left:8px;font-weight:bold;color:var(--accent-1);\">${item.cost}G</div>`;
                div.onclick = () => {
                    if (state.gold >= item.cost) {
                        state.gold -= item.cost;
                        item.effect();
                        updateUI();
                        // re-open to refresh list and costs
                        openShop();
                    }
                };
                shopDiv.appendChild(div);
            });
        }
        function closeShop() {
            state.shopOpen = false;
            const shopEl = document.getElementById('shop');
            shopEl.classList.remove('open');
            shopEl.setAttribute('aria-hidden','true');
            // wait for transition then hide
            setTimeout(() => { if (!state.shopOpen) shopEl.style.display = 'none'; }, 300);
        }

        // --- Event Listeners ---
        document.getElementById('rollBtn').onclick = () => {
            if (state.shopOpen) return;
            if (state.rerolls > 0) {
                state.rerolls--;
                rollDice();
                updateUI();
            }
        };
        document.getElementById('shopBtn').onclick = () => {
            openShop();
        };
        document.getElementById('closeShop').onclick = () => {
            closeShop();
        };

        // --- Initial Draw ---
        function mainLoop() {
            ctx.clearRect(0,0,W,H);
            drawDiceRow(state.diceResults.length ? state.diceResults : [1,1,1,1,1], state.deck, 0);
            requestAnimationFrame(mainLoop);
        }
        updateUI();
        mainLoop();

        // --- Unlock Dice with Score ---
        setInterval(() => {
            diceTypes.forEach(dt => {
                if (state.score >= dt.unlock && !state.unlocked.includes(dt.key)) {
                    state.unlocked.push(dt.key);
                }
            });
        }, 1000);

    </script>
</body>
</html>